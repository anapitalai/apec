<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: routes/userRoutes.js</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Source: routes/userRoutes.js</h1>

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>/**
 * User routes
 * http://localhost:3000
 * 
 */
const express = require('express');
const router = express.Router();
const mongoose = require('mongoose');
const uriUtil = require('mongodb-uri');
const bcrypt = require('bcryptjs');
const jwt = require('jsonwebtoken');
const checkMiddlewares = require('../middlewares/checkAuth')
const usersController = require('../controllers/userController')

const User = require('../models/userModel');
const DateUpdate = require('../middlewares/date');
const multer = require('multer');

const storage=multer.diskStorage({
    destination: function(req,file,cb){
        cb(null,'./avatars/');
    },
    filename: function(req,file,cb){
        cb(null,new Date().toISOString()+file.originalname);
    }
});
const fileFilter=(req,file,cb)=>{
    if(file.mimetype==='image/jpeg' || file.mimetype==='image/png'){
        cb(null,true);
    }
    else{
        cb(null,false);
    }
};
const upload = multer({storage:storage,limit:{
    fileSize:1024 * 1024 * 5
},
fileFilter:fileFilter
}); 


//allUsers


//get all alumni routes
router.get('/users',checkMiddlewares.auth,usersController.getAllUsers)
   

//add a login user route
router.post('/signup',usersController.createUser)//upload.single('avatar')
//login
router.post('/login',usersController.auth)

//get single alumni route
router.get('/:memberId',(req,res,next)=>{
    const id=req.params.memberId;
    User.findById(id)
    .exec()
    .then(doc=>{
       console.log('From DB',doc);
       if(doc){
        res.status(200).json(doc);
       }
        else{
            res.status(400).json({
                message:'No valid member for the given ID'
            });
        }
      
   })
    .catch(err=>{
        console.log(err);
        res.status(500).json({error:err});
    });
   });

   router.put('/:memberId',(req,res)=>{
    const _id = req.params.memberId;
   // User.findOneAndUpdate({_id},
   User.findByIdAndUpdate({_id},
      req.body,
      { new: true },
      (err, user) => {
      if (err) {
         res.status(400).json(err);
      }

       res.json(user);


    });
    
    });
//date
router.put('/update/:memberId',(req,res)=>{
    const _id = req.params.memberId;
    var ndate=new Date();
    User.findByIdAndUpdate(_id,{ updatedAt:ndate },
      //req.body,
      //{ new: true },
      (err, user) => {
      if (err) {
         res.status(400).json(err);
      }

       res.json(user);


    });
    
    });
   
//delete route
router.delete('/:userId',(req,res,next)=>{
    
    User.remove({_id:req.params.userId})
    .exec()
    .then(result=>{
        return res.status(200).json({message:'User purged'});
    })
    .catch(err=>{
        console.log(err);
        res.status(500).json({error:err});
    });

   
    
});




module.exports = router</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Global</h3><ul><li><a href="global.html#express">express</a></li><li><a href="global.html#rateLimiter">rateLimiter</a></li><li><a href="global.html#server">server</a></li></ul>
</nav>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc/jsdoc">JSDoc 3.6.6</a> on Tue Nov 03 2020 14:24:35 GMT+1000 (Papua New Guinea Time)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
